# Технический долг. Устранение долга
### Что такое технический долг?
[![Всё ОК!](https://pp.userapi.com/c846017/v846017122/1f51ea/yFIVLjh3_JI.jpg "Без паники!")](https://pp.userapi.com/c846017/v846017122/1f51ea/yFIVLjh3_JI.jpg "Без паники!")  
Не весь корявый написанный код по определению является техническим долгом. Конечно, если есть такой код, то его лучше рано или поздно переписать, но наша команда понимает, что код можно шлифовать и полировать до бесконечности, ведь совершенству нет предела. Для того, чтобы бороться с техническим долгом стоит разобраться, что же это такое. Отличное описание технического долга описал Мартин Фаулер, известный зарубежный автор ряда книг о рефакторинге и языку UML, в [своём блоге](https://martinfowler.com/bliki/TechnicalDebt.html "своём блоге").
> Like a financial debt, the technical debt incurs interest payments, which come in the form of the extra effort that we have to do in future development because of the quick and dirty design choice.

То есть, **чем больше усилий** во время разработки мы затрачиваем из-за какого-то куска кода, **тем большим техническим долгом** он является.

[![](https://habrastorage.org/webt/tj/yd/ai/tjydai7dmvrpszvocl9_n1kpg1g.png)](https://habrastorage.org/webt/tj/yd/ai/tjydai7dmvrpszvocl9_n1kpg1g.png)

Важнейшим показателем того, что на проекте есть проблема с техническим долгом, это, конечно же, сам код. Прежде всего, стоит сказать об особенности написания кода. Дело в том, что написание и чтение кода — два совершенно разных процесса. Когда разработчик пишет код, он сосредоточен лишь на контексте задачи. Но изменение отдельного участка кода влияет на общую картину происходящего. В свою очередь, прежде чем изменять написанный код, нужно иметь представление не только о конкретном участке, но и обо всей картине в целом. Но при чтении, границы контекстов, в рамках которых был написан код, стираются на общем представлении. Такая разница между чтением и написанием кода генерирует дополнительную сложность, которая прямым образом влияет на его качество.

Исходя из вышесказанного мы решили обратить внимание на следующие признаки технического долга:
1. **Участки кода, которые переписываются вместе с расширением и масштабированием самого приложения**. Логично, что концепция ООП подразумевает модульность, а следовательно и очевидно понятное поведение метода.
2. **Дублирование кода**. В основном возникает при программировании «Копированием-вставками» и при необходимости реализации функциональности, максимально похожей на другую.
[![Дублирование кода](https://pbs.twimg.com/media/CeJbamnXEAALsKL.jpg:large "Дублирование кода")](https://pbs.twimg.com/media/CeJbamnXEAALsKL.jpg:large "Дублирование кода")
3. **Пометки TODO и FIXME**. В основном эти метки используются для каких-то отложенных фич и функционала приложения. Во время разработки, когда до сдачи спринта остаётся меньше 10 минут, реализации каких-то функций и методов могут опускаться и в следствие этого и образуется технический долг.
4. **Отсутствие тестов**. Код, который не покрыт тестами - это карточный домик. Внесение изменений без наличия тестов является затруднительным и, следовательно, мы стараемся избегать лишних (а порой - крайне необходимых) изменений.
5. **Устаревшие библиотеки и инструменты разработки**. Библиотеки и модули имеют свойство обновляться, зачастую поддержка старых версий затруднительна.
6. **Отсутствие стандартов разработки**. Если каждый разработчик в команде делает то, что хочет, ни к чему хорошему это не приведёт.
7. **Отсутствие технической документации и комментариев**. Документация позволяет легче понять состояние кода после пуллинга кода из репозитория. Комментарии могут подсказать о ходе мыслей другого разработчика и не только.
8. **Запутанная архитектура**. Всё элегантное - в простом. Чем проще архитектура приложения, чем проще её расширять и масштабировать, поддерживать и отлаживать.
9. **Отсутствие автоматизации**. Автоматизация тестирования, сборки и развёртывания приложения ускоряет и упрощает процесс работы над ним.
10. **Незакоммиченный код и долгоживущие ветки**. Отсутствие коммитов не позволяет откатить приложение на более раннюю версию, а долгоживущие ветки противоречат смыслу существования самих веток.

[![](https://pp.userapi.com/c846017/v846017122/1f51d9/bB5xz6dbtCA.jpg)](https://pp.userapi.com/c846017/v846017122/1f51d9/bB5xz6dbtCA.jpg)

### Анализ проекта на наличие технического долга
Анализ кода на наличие технического долга мы решили проводить двумя способами: вручную и автоматически. Из автоматических средств анализа кода мы прибегли к стандартному анализатору, встроенному в IntelliJ IDEA, и к Checkstyle - стороннему анализатору кода, разработанному Оливером Бёрном. В качестве набора соглашений о стиле кода был выбран [Java Style Guide](https://google.github.io/styleguide/javaguide.html "Java Style Guide") от компании Google.

[![Это мой скрин. Таких скриншотов много, но этот мой](https://pp.userapi.com/c846017/v846017122/1f514c/GT7kIFeQ3-c.jpg "Это мой скрин. Таких скриншотов много, но этот мой")](https://pp.userapi.com/c846017/v846017122/1f514c/GT7kIFeQ3-c.jpg "Это мой скрин. Таких скриншотов много, но этот мой")

Устранение технического долга можно сравнить с лечением болезни, где первый шаг к выздоровлению - признание себя больным. Каждый участник нашего проекта признаёт наличие (и, что более серьёзно, нарастание) технического долга. Попытки справиться с техническим долгом в одиночку сравним с боем с ветряными мельницами. Если есть **осознание** проблемы - есть и её решение. Устранение технического долга требует исключительно системного подхода.

[![Пришло время устранять долги!](https://habrastorage.org/webt/t-/zt/wv/t-ztwva0xdzemq6jhb0aocf_pc4.png "Пришло время устранять долги!")](https://habrastorage.org/webt/t-/zt/wv/t-ztwva0xdzemq6jhb0aocf_pc4.png "Пришло время устранять долги!")

Подробный отчёт checkstyle можно найти по ссылке в репозитории проекта: [тык!](https://github.com/Bulbash3r/Kewbr-Quiz/tree/master/Development%20Dept/checkstyle "тык!")

Проанализировав код проекта по каждому из признаков мы выяснили, что:

| Признак  | Результат анализа  |
| :---| :--- |
| 1. Участки кода, которые переписываются вместе с расширением и масштабированием самого приложения | Такие участки кода не обнаружены, изначально все методы писались именно так, как они и были задуманы и должны работать по итогу. Такое возможно благодаря подробной проработке классов на этапе проектирования приложения. |
| 2. Дублирование кода | Checkstyle подсказывает, что дублирование кода отсутствует. |
| 3. Пометки `TODO` и `FIXME`  | В коде присутствует несколько меток `TODO`, которые были оставлены в результате нехватки времени на реализацию функционала.  |
| 4. Отсутствие тестов | Код не покрыт тестами. |
| 5. Устаревшие библиотеки и инструменты разработки  |  Наша команда использует свежие версии библиотек (gson - 2.8.5, netty - 4.1.33) и обновлённое ПО. |
| 6. Отсутствие стандартов разработки | Ввиду того, что java-разработчики стараются придерживаться одного кодстайла, код различных разработчиков в одном проекте имеет примерно одинаковый вид. Наличие единого кодстайла и стандарта упрощает чтение и поддержку кода. |
| 7. Отсутствие технической документации и комментариев |Техническая документация и комментарии присутствуют лишь в старых классах. В коде, написанном за последний месяц, отсутствуют комментарии, а у классов отсутствует документация. |
| 8. Запутанная архитектура | Приложение является оконным и реализует концепцию архитектуры MVC. Библиотека JavaFX не прощает нарушения логики архитектуры, а стандартные средства разработки и Scene Builder упрощают понимание архитектуры и дальнейшую разработку. Были небольшие проблемы с совместимостью кода при переносе редактора пакетов в само приложение. |
| 9. Отсутствие автоматизации |Ввиду отсутствия тестов, отсутствует и их автоматизация (логично). При этом сборка и развёртывание приложения автоматизированны.  |
| 10. Незакоммиченный код и долгоживущие ветки | Код относительно часто коммитится каждым из участников команды. За время создания проекта была создана одна ветка `Editor`, отведённая **строго** под разработку редактора. После окончания разработки ветки были слиты в `master`.|

[![Технический долг? Мы в этом шарим!](https://habrastorage.org/webt/jo/ga/k7/jogak7_rwvfj2vfrfmivzx1sav4.jpeg "Технический долг? Мы в этом шарим!")](https://habrastorage.org/webt/jo/ga/k7/jogak7_rwvfj2vfrfmivzx1sav4.jpeg "Технический долг? Мы в этом шарим!")

### План мероприятий по устранению технического долга

- Устранение меток `TODO` (8 SP)
- Покрытие кода тестами (13 SP)
- Восполнение пробелов в документации и комментариях (3 SP)
- Устранение проблем, возникших при переносе редактора в основное приложение (3 SP)
- Автоматизация тестирования кода (5 SP)

### Оценка плана мероприятий по устранению технического долга
Общий технический долг составляет 32 story points. Основные проблемы заключаются в тестировании кода, технической документации и архитектуре приложения. В первую очередь стоит обратить внимание на тестирование и реализацию отложенного функционала.

### Сравнение объёма технического долга и недоимплементированных фич

На момент написания данного документа не было реализовано проведение самого квиза. Данная функциональность оценивается в 34 SP и является основной, технический долг же оценивается в 32 SP. Реализация фичи является для нашей команды первостепенной, так как является важнейшей функциональностью приложения, без которого оно не имеет смысла, поэтому мы сконцентрируем большую часть сил на доработке приложения, однако не стоит забывать и об устранении технического долга. Кушнеренко Роман лучше всех из нашей команды знаком с тестированием, следовательно он и займётся устранением технического долга (долг по тестированию составляет больше половины от всего технического долга).

### Выводы и обосновние необходимости устранения долга, коррективы в план разработки проекта

Первоочередными целями на данном этапе является написание тестов и автоматизация тестирования, доработка документации, а также, согласно последнему спринту, реализация итогового приложения. В сумме технический долг и цель последнего спринта составляют 66 SP.
